import { getMetadata } from '../../scripts/aem.js';
import { loadFragment } from '../fragment/fragment.js';

/**
 * Toggles the visibility of a submenu
 * @param {HTMLElement} dropdown The dropdown element
 */
function toggleSubMenu(dropdown) {
  const expanded = dropdown.getAttribute('aria-expanded') === 'true';
  dropdown.setAttribute('aria-expanded', expanded ? 'false' : 'true');
}

export default async function decorate(block) {
  const navMeta = getMetadata('nav');
  const navPath = navMeta ? new URL(navMeta, window.location).pathname : '/nav';
  const fragment = await loadFragment(navPath);

  block.textContent = '';
  const nav = document.createElement('nav');
  nav.id = 'nav';
  nav.setAttribute('aria-expanded', 'false');
  nav.innerHTML=brandLogo();
  while (fragment.firstElementChild) {
    nav.append(fragment.firstElementChild);
  }

  const navWrapper = document.createElement('div');
  navWrapper.className = 'nav-wrapper';
  navWrapper.append(nav);
  block.append(navWrapper);

  // Add dropdown toggle functionality for lists with sublists
  nav.querySelectorAll('li').forEach((listItem) => {
    const sublist = listItem.querySelector('ul');
    if (sublist) {
      listItem.classList.add('nav-drop');
      listItem.setAttribute('aria-expanded', 'false');

      // Add a toggle button
      const toggleButton = document.createElement('button');
      toggleButton.className = 'nav-toggle-button';
      toggleButton.setAttribute('aria-label', 'Expand/Collapse submenu');
      toggleButton.innerHTML = '▼';
      listItem.prepend(toggleButton);

      // Add event listener for toggling submenu
      toggleButton.addEventListener('click', () => toggleSubMenu(listItem));
    }
  });

  // Add hamburger menu toggle for mobile view
  const mainToggleButton = document.createElement('button');
  mainToggleButton.className = 'main-nav-toggle';
  mainToggleButton.setAttribute('aria-label', 'Toggle Navigation');
  mainToggleButton.innerHTML = '☰';
  mainToggleButton.addEventListener('click', () => {
    const expanded = nav.getAttribute('aria-expanded') === 'true';
    nav.setAttribute('aria-expanded', expanded ? 'false' : 'true');
    document.body.style.overflowY = expanded ? '' : 'hidden'; // Lock scrolling
  });
  // remove header toggle button block.prepend(mainToggleButton);
  const rect = document.body.getBoundingClientRect();
  navWrapper.style.left=rect.x - 40 + 'px'
  window.addEventListener('resize',()=>{
    const rect = document.body.getBoundingClientRect();
    navWrapper.style.left=Math.max(rect.x - 40,-10) + 'px'
  })
}

function brandLogo(){
  return `<span class="brandLogo"><svg id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1551.39 339.74">
  <defs>
    <style>
      .cls-1 {
        fill: #00acb3;
      }

      .cls-2 {
        fill: #fd495c;
      }

      .cls-3 {
        fill: #415364;
      }
    </style>
  </defs>
  <g id="Layer_1-2" data-name="Layer 1">
    <g>
      <g>
        <path class="cls-3" d="m342.57,240.25h15.25c9.79,0,16.58,6.01,16.58,17.69v19.03c0,9.68-4.12,14.36-10.02,16.47l10.35,25.26h-8.79l-9.13-23.26h-6.23v23.26h-8.01v-78.46Zm14.36,47.63c5.68,0,9.68-2.23,9.68-12.58v-17.36c0-7.57-4.34-10.02-9.68-10.02h-6.34v39.95h6.34Z"></path>
        <path class="cls-3" d="m384.86,303.57v-32.38c0-9.46,5.45-15.69,15.02-15.69,10.57,0,14.91,6.45,14.91,17.69v17.25h-22.37v14.47c0,4.67,3.56,7.68,7.46,7.68,4.34,0,7.34-2.67,7.34-6.9v-.67h7.57v.67c0,7.68-5.45,13.69-14.91,13.69s-15.02-6.01-15.02-15.8Zm22.37-18.7v-13.35c0-6.45-2.78-9.24-7.34-9.24-4.01,0-7.46,2.67-7.46,8.01v14.58h14.8Z"></path>
        <path class="cls-3" d="m422.7,304.79h7.57c0,5.23,3.12,7.79,7.68,7.79s7.23-3.45,7.23-7.12c0-2.67-.22-4.78-3.45-8.57l-12.24-14.24c-4.56-5.23-6.01-9.9-6.01-13.58,0-7.01,5.01-13.58,13.91-13.58,9.57,0,14.91,4.9,14.91,14.47h-7.46c0-5.34-3.23-7.68-6.9-7.68-4.23,0-7.01,2.78-7.01,6.9,0,2.23.89,4.9,3.23,7.57l12.35,14.24c5.34,6.23,6.23,10.13,6.23,14.69,0,6.68-4.9,13.69-14.8,13.69s-15.25-5.56-15.25-14.58Z"></path>
        <path class="cls-3" d="m462.98,256.27h7.12v4.45c1.22-1.78,4.56-5.01,10.13-5.01,7.9,0,12.69,4.67,12.69,14.69v34.16c0,9.9-4.79,14.69-12.69,14.69-5.68,0-8.57-3.23-9.68-5.01v25.48h-7.57v-83.46Zm14.91,56.31c4.45,0,7.46-2.67,7.46-7.79v-34.61c0-5.23-3-7.9-7.46-7.9-4.12,0-7.34,2.56-7.34,7.68v34.83c0,5.12,3.12,7.79,7.34,7.79Z"></path>
        <path class="cls-3" d="m508.05,240.69c2.45,0,4.67,2,4.67,4.67,0,2.45-2.23,4.56-4.67,4.56-2.67,0-4.79-2.11-4.79-4.56,0-2.67,2.11-4.67,4.79-4.67Zm-3.89,15.58h7.57v62.43h-7.57v-62.43Z"></path>
        <path class="cls-3" d="m523.41,256.27h7.12v4.45c2.78-4.45,7.12-5.34,11.35-5.01v7.57c-6.57-.67-10.91,2.34-10.91,9.79v45.63h-7.57v-62.43Z"></path>
        <path class="cls-3" d="m547.89,304.57v-34.28c0-10.02,4.9-14.69,12.69-14.69,5.56,0,9.01,3.23,10.13,5.01v-4.34h7.12v62.43h-7.12v-4.34c-1.11,1.67-4.56,5.01-10.13,5.01-7.79,0-12.69-4.67-12.69-14.8Zm15.02,8.12c4.34,0,7.34-2.56,7.34-7.79v-35.17c0-5.01-3-7.57-7.34-7.57s-7.34,2.67-7.34,7.9v34.83c0,5.23,3,7.79,7.34,7.79Z"></path>
        <path class="cls-3" d="m589.85,304.35v-41.29h-4.23v-6.46c4.9,0,6.23-1.56,6.23-9.9h5.56v9.57h9.13v6.79h-9.13v41.73c0,7.57,3.89,8.01,9.13,7.57v6.68c-7.01.56-16.69,1-16.69-14.69Z"></path>
        <path class="cls-3" d="m613.55,303.57v-32.38c0-9.46,5.45-15.58,15.02-15.58s14.91,6.12,14.91,15.58v32.38c0,9.79-5.56,15.8-14.91,15.8s-15.02-6.01-15.02-15.8Zm15.02,8.9c4.23,0,7.34-2.56,7.34-7.9v-34.28c0-5.12-3-7.9-7.34-7.9s-7.46,2.78-7.46,7.9v34.28c0,5.34,3.12,7.9,7.46,7.9Z"></path>
        <path class="cls-3" d="m654.72,256.27h7.12v4.45c2.78-4.45,7.12-5.34,11.35-5.01v7.57c-6.57-.67-10.91,2.34-10.91,9.79v45.63h-7.57v-62.43Z"></path>
        <path class="cls-3" d="m692.56,317.93l-13.13-61.65h8.01l9.01,46.63,9.01-46.63h8.12l-17.92,83.46h-7.79l4.67-21.81Z"></path>
        <path class="cls-3" d="m735.4,302.01h7.9c0,7.12,4.12,9.79,9.01,9.79s8.35-3.34,8.35-8.68c0-3.56-.78-6.34-4.67-11.91l-13.69-19.92c-4.01-5.9-6.23-11.46-6.23-16.25,0-9.68,7.01-15.58,16.03-15.58s16.03,6.01,16.03,16.92h-7.79c0-6.68-4.01-9.35-8.35-9.35-4.56,0-8.12,2.89-8.12,8.01,0,3.67,1.56,7.12,4.34,11.24l13.8,19.92c4.9,7.12,6.57,11.8,6.57,17.25,0,9.57-6.57,16.03-16.36,16.03s-16.8-6.23-16.8-17.47Z"></path>
        <path class="cls-3" d="m784.92,317.93l-13.13-61.65h8.01l9.01,46.63,9.01-46.63h8.12l-17.92,83.46h-7.79l4.67-21.81Z"></path>
        <path class="cls-3" d="m814.41,256.27h7.12v4.45c1.22-1.89,4.56-5.12,10.13-5.12,7.9,0,12.69,4.79,12.69,14.69v48.41h-7.57v-48.74c0-5.23-3.34-7.9-7.46-7.9s-7.35,2.67-7.35,7.57v49.08h-7.57v-62.43Z"></path>
        <path class="cls-3" d="m855.03,303.57v-32.38c0-9.46,5.45-15.58,15.02-15.58s14.91,6.12,14.91,15.58v.67h-7.57v-1.56c0-5.12-3-7.9-7.34-7.9s-7.46,2.78-7.46,7.9v34.28c0,5.34,3.12,7.9,7.46,7.9s7.34-2.56,7.34-7.9v-1.34h7.57v.33c0,9.79-5.56,15.8-14.91,15.8s-15.02-6.01-15.02-15.8Z"></path>
        <path class="cls-3" d="m903.78,317.93l-13.13-61.65h8.01l9.01,46.63,9.01-46.63h8.12l-17.92,83.46h-7.79l4.67-21.81Z"></path>
        <path class="cls-3" d="m933.27,304.35v-41.29h-4.23v-6.46c4.9,0,6.23-1.56,6.23-9.9h5.56v9.57h9.13v6.79h-9.13v41.73c0,7.57,3.9,8.01,9.13,7.57v6.68c-7.01.56-16.69,1-16.69-14.69Z"></path>
        <path class="cls-3" d="m963.42,240.69c2.45,0,4.67,2,4.67,4.67,0,2.45-2.23,4.56-4.67,4.56-2.67,0-4.79-2.11-4.79-4.56,0-2.67,2.11-4.67,4.79-4.67Zm-3.9,15.58h7.57v62.43h-7.57v-62.43Z"></path>
        <path class="cls-3" d="m978,304.57v-34.28c0-10.02,4.9-14.69,12.69-14.69,5.56,0,9.01,3.23,10.13,5.01v-4.34h7.12v62.43h-7.12v-4.34c-1.11,1.67-4.56,5.01-10.13,5.01-7.79,0-12.69-4.67-12.69-14.8Zm15.02,8.12c4.34,0,7.34-2.56,7.34-7.79v-35.17c0-5.01-3-7.57-7.34-7.57s-7.34,2.67-7.34,7.9v34.83c0,5.23,3,7.79,7.34,7.79Z"></path>
        <path class="cls-3" d="m1019.95,234.35h7.57v84.36h-7.57v-84.36Z"></path>
        <path class="cls-3" d="m1052.33,240.25h7.9l10.91,63.1,10.79-63.1h7.9l-14.69,78.46h-8.12l-14.69-78.46Z"></path>
        <path class="cls-3" d="m1102.08,240.69c2.45,0,4.67,2,4.67,4.67,0,2.45-2.23,4.56-4.67,4.56-2.67,0-4.78-2.11-4.78-4.56,0-2.67,2.11-4.67,4.78-4.67Zm-3.89,15.58h7.57v62.43h-7.57v-62.43Z"></path>
        <path class="cls-3" d="m1117.43,256.27h7.12v4.45c2.78-4.45,7.12-5.34,11.35-5.01v7.57c-6.57-.67-10.91,2.34-10.91,9.79v45.63h-7.57v-62.43Z"></path>
        <path class="cls-3" d="m1145.03,304.46v-48.19h7.57v49.08c0,4.67,3.23,7.12,7.46,7.12s7.35-2.45,7.35-7.12v-49.08h7.57v48.19c0,9.01-5.9,14.91-14.91,14.91s-15.02-5.9-15.02-14.91Z"></path>
        <path class="cls-3" d="m1184.54,304.79h7.57c0,5.23,3.12,7.79,7.68,7.79s7.23-3.45,7.23-7.12c0-2.67-.22-4.78-3.45-8.57l-12.24-14.24c-4.56-5.23-6.01-9.9-6.01-13.58,0-7.01,5.01-13.58,13.91-13.58,9.57,0,14.91,4.9,14.91,14.47h-7.46c0-5.34-3.23-7.68-6.9-7.68-4.23,0-7.01,2.78-7.01,6.9,0,2.23.89,4.9,3.23,7.57l12.35,14.24c5.34,6.23,6.23,10.13,6.23,14.69,0,6.68-4.9,13.69-14.8,13.69s-15.25-5.56-15.25-14.58Z"></path>
        <path class="cls-3" d="m1237.62,240.25h7.9l10.91,63.1,10.79-63.1h7.9l-14.69,78.46h-8.12l-14.69-78.46Z"></path>
        <path class="cls-3" d="m1278.9,304.57v-34.28c0-10.02,4.9-14.69,12.69-14.69,5.56,0,9.01,3.23,10.13,5.01v-4.34h7.12v62.43h-7.12v-4.34c-1.11,1.67-4.56,5.01-10.13,5.01-7.79,0-12.69-4.67-12.69-14.8Zm15.02,8.12c4.34,0,7.34-2.56,7.34-7.79v-35.17c0-5.01-3-7.57-7.34-7.57s-7.34,2.67-7.34,7.9v34.83c0,5.23,3,7.79,7.34,7.79Z"></path>
        <path class="cls-3" d="m1319.96,303.57v-32.38c0-9.46,5.45-15.58,15.02-15.58s14.91,6.12,14.91,15.58v.67h-7.57v-1.56c0-5.12-3-7.9-7.35-7.9s-7.46,2.78-7.46,7.9v34.28c0,5.34,3.12,7.9,7.46,7.9s7.35-2.56,7.35-7.9v-1.34h7.57v.33c0,9.79-5.56,15.8-14.91,15.8s-15.02-6.01-15.02-15.8Z"></path>
        <path class="cls-3" d="m1357.69,303.57v-32.38c0-9.46,5.45-15.58,15.02-15.58s14.91,6.12,14.91,15.58v.67h-7.57v-1.56c0-5.12-3-7.9-7.35-7.9s-7.46,2.78-7.46,7.9v34.28c0,5.34,3.12,7.9,7.46,7.9s7.35-2.56,7.35-7.9v-1.34h7.57v.33c0,9.79-5.56,15.8-14.91,15.8s-15.02-6.01-15.02-15.8Z"></path>
        <path class="cls-3" d="m1401.31,240.69c2.45,0,4.67,2,4.67,4.67,0,2.45-2.23,4.56-4.67,4.56-2.67,0-4.78-2.11-4.78-4.56,0-2.67,2.11-4.67,4.78-4.67Zm-3.89,15.58h7.57v62.43h-7.57v-62.43Z"></path>
        <path class="cls-3" d="m1416.56,256.27h7.12v4.45c1.22-1.89,4.56-5.12,10.13-5.12,7.9,0,12.69,4.79,12.69,14.69v48.41h-7.57v-48.74c0-5.23-3.34-7.9-7.46-7.9s-7.34,2.67-7.34,7.57v49.08h-7.57v-62.43Z"></path>
        <path class="cls-3" d="m1457.06,303.57v-32.38c0-9.46,5.45-15.69,15.02-15.69,10.57,0,14.91,6.45,14.91,17.69v17.25h-22.37v14.47c0,4.67,3.56,7.68,7.46,7.68,4.34,0,7.34-2.67,7.34-6.9v-.67h7.57v.67c0,7.68-5.45,13.69-14.91,13.69s-15.02-6.01-15.02-15.8Zm22.37-18.7v-13.35c0-6.45-2.78-9.24-7.34-9.24-4.01,0-7.46,2.67-7.46,8.01v14.58h14.8Z"></path>
      </g>
      <g id="Logo">
        <path class="cls-3" d="m490.81,169.22c.72,1.67,1.19,3.1,1.19,4.77,0,5.49-3.58,10.74-10.73,10.74-5.49,0-8.59-2.86-10.26-6.68l-15.98-34.83h-74.91l-15.98,34.83c-1.67,3.82-4.77,6.68-10.26,6.68-7.16,0-10.73-5.25-10.73-10.74,0-1.67.48-3.1,1.19-4.77l62.98-140.51c1.91-4.53,5.25-6.68,10.26-6.68s8.35,2.15,10.26,6.68l62.98,140.51Zm-73.24-113.79l-29.1,67.51h58.21l-29.1-67.51Z"></path>
        <path class="cls-3" d="m604.43,184.55h-59.16c-6.55,0-11.64-5.33-11.64-11.88V34.72c0-6.55,5.09-11.64,11.64-11.64h56.49c30.3,0,49.46,16,49.46,40,0,15.76-9.45,28.37-24.97,34.91,19.64,3.64,34.67,16.24,34.67,40.97s-18.67,45.58-56.49,45.58Zm-1.94-140.61h-45.58v45.09h46.06c16.49,0,24.73-11.15,24.73-23.03,0-14.79-10.18-22.06-25.21-22.06Zm-45.58,65.94v53.82h49.46c19.88,0,31.27-11.15,31.27-27.15s-11.88-26.67-31.52-26.67h-49.21Z"></path>
        <path class="cls-3" d="m717.63,185.33c-7.03,0-11.88-5.33-11.88-11.88V33.81c0-7.03,4.61-11.88,11.88-11.88h65.22c36.85,0,55.03,19.64,55.03,47.52,0,21.58-11.4,37.58-33.21,43.64l27.15,55.52c.73,1.7,1.21,3.4,1.21,5.09,0,5.82-4.12,11.64-11.39,11.64-5.58,0-8.49-2.42-10.43-6.55l-30.79-63.03h-51.4v57.7c0,6.55-4.61,11.88-11.4,11.88Zm11.4-142.07v52.12h58.43c17.94,0,27.15-11.64,27.15-25.94s-9.21-26.18-27.15-26.18h-58.43Z"></path>
        <path class="cls-3" d="m978.26,26.99c2.39-3.1,5.01-4.77,9.06-4.77,5.25,0,10.5,4.06,10.5,10.26,0,2.86-.95,4.77-2.38,6.92l-52.72,73.72v60.12c0,6.44-4.54,11.69-11.69,11.69s-11.69-5.25-11.69-11.69v-60.12l-52.72-73.72c-1.43-2.15-2.39-4.06-2.39-6.92,0-6.2,5.25-10.26,10.5-10.26,4.06,0,6.68,1.67,9.07,4.77l47.24,65.84,47.24-65.84Z"></path>
        <path class="cls-3" d="m1084.85,184.67c-20.66,0-41.78-6.81-55.4-17.37-3.52-2.82-6.11-6.57-6.11-10.56,0-5.87,4.23-9.16,9.63-9.16,2.81,0,5.16,1.17,7.98,2.82,12.91,8.22,24.88,14.55,44.13,14.55,24.88,0,37.09-10.09,37.09-23.47,0-15.73-13.85-20.66-42.02-29.11-41.79-12.44-54.93-25.35-54.93-47.42,0-28.17,24.88-42.25,60.1-42.25,12.21,0,24.18,2.35,35.45,6.57,7.98,3.05,19.01,8.68,19.01,15.96,0,5.4-3.05,10.1-9.62,10.1-1.65,0-3.29-.47-4.46-1.17-11.5-6.57-24.65-11.5-40.14-11.5-23.01,0-37.8,6.57-37.8,21.83,0,13.85,11.5,18.78,38.5,27.23,37.56,11.74,58.45,21.83,58.45,48.59,0,25.12-20.66,44.37-59.86,44.37Z"></path>
        <path class="cls-3" d="m1292.75,28.9c2.15-5.25,5.72-6.68,10.02-6.68,5.25,0,10.97,3.58,10.97,10.74,0,1.43-.48,2.86-1.19,4.77l-60.36,140.75c-1.67,4.05-4.77,6.44-9.78,6.44s-8.11-2.39-9.78-6.44l-60.36-140.75c-.71-1.91-1.19-3.34-1.19-4.77,0-7.16,5.72-10.74,10.97-10.74,4.3,0,7.87,1.43,10.02,6.68l50.34,121.43,50.34-121.43Z"></path>
        <path class="cls-3" d="m1408.68,184.67c-47.65,0-79.34-36.85-79.34-80.99s31.69-80.99,79.34-80.99,79.35,36.86,79.35,80.99-31.69,80.99-79.35,80.99Zm0-141.55c-36.38,0-56.81,28.4-56.81,60.56s20.42,60.56,56.81,60.56,56.81-28.41,56.81-60.56-20.42-60.56-56.81-60.56Z"></path>
      </g>
      <path class="cls-1" d="m156.24.17c-24.29-1.09-47.33,3.13-68.22,11.46-.05.02-.03.1.03.08,16.75-4.8,34.68-6.93,53.39-5.61,74.56,5.23,135.45,64.72,142.31,139.15,8.11,87.92-58.73,163.9-145.97,168-42.32,1.99-81.45-13.32-110.54-39.69,31.7,34.98,78.21,56.05,129.05,53.66,93.77-4.41,165.4-86.88,155.02-181.64C302.6,66.09,236.11,3.74,156.24.17Z"></path>
      <path class="cls-2" d="m18.65,145.36c5.51-51.23,52.46-99.73,104.59-107.63,20.59-3.12,44.81.96,56.93,5.54-15.16-7.57-41.09-12.82-63.14-10.93C57.2,37.49,4.05,91.88.27,151.15c-4.72,73.95,53.68,135.58,126.7,135.93,23.27.11,45.09-6.05,63.93-16.84-6.73,3.07-13.78,5.55-21.1,7.37-9.65,2.4-19.74,3.66-30.14,3.61-71.83-.34-128.9-62.52-121.01-135.85Z"></path>
      <path class="cls-2" d="m179.9,120.16c15.64,10.32,25.97,28.03,25.97,48.17,0,31.87-25.83,57.7-57.7,57.7s-55.09-23.37-57.46-53.05c-.03.85-.13,1.68-.13,2.54,0,34.16,27.69,61.85,61.85,61.85s61.85-27.69,61.85-61.85c0-24.28-14.02-45.23-34.38-55.35Z"></path>
      <path class="cls-1" d="m151.67,82.19c51.3,0,92.88,41.58,92.88,92.88,0,12.29-2.41,24.01-6.75,34.75,7.45-13.85,11.69-29.7,11.69-46.53,0-54.32-44.04-98.36-98.36-98.36s-98.36,44.04-98.36,98.36c0,19.96,5.96,38.51,16.17,54.02-6.49-12.68-10.17-27.02-10.17-42.24,0-51.3,41.58-92.88,92.88-92.88Z"></path>
      <path class="cls-3" d="m1551.39,46.4c0,14.76-11.59,26.35-26.66,26.35s-26.82-11.59-26.82-26.35,11.9-26.03,26.82-26.03,26.66,11.59,26.66,26.03Zm-46.82,0c0,11.59,8.57,20.79,20.31,20.79s19.84-9.21,19.84-20.63-8.41-20.95-20-20.95-20.16,9.36-20.16,20.79Zm16.03,13.65h-6.03v-26.03c2.38-.48,5.71-.79,10-.79,4.92,0,7.14.79,9.05,1.9,1.43,1.11,2.54,3.17,2.54,5.71,0,2.86-2.22,5.08-5.4,6.03v.32c2.54.95,3.97,2.86,4.76,6.35.79,3.97,1.27,5.55,1.91,6.51h-6.51c-.79-.95-1.27-3.33-2.06-6.35-.48-2.86-2.06-4.13-5.4-4.13h-2.86v10.47Zm.16-14.76h2.86c3.33,0,6.03-1.11,6.03-3.81,0-2.38-1.75-3.97-5.55-3.97-1.59,0-2.7.16-3.33.32v7.46Z"></path>
    </g>
  </g>
</svg></span>`
}
